<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DashDig Widget - Browser Compatibility Test</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      padding: 2rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      color: #667eea;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      color: #666;
      margin-bottom: 2rem;
    }

    .test-section {
      margin: 2rem 0;
      padding: 1.5rem;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }

    .test-section h2 {
      color: #333;
      margin-bottom: 1rem;
      font-size: 1.3rem;
    }

    .test-result {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin: 0.5rem 0;
      padding: 0.75rem;
      background: white;
      border-radius: 6px;
    }

    .test-result.pass {
      border-left: 4px solid #28a745;
    }

    .test-result.fail {
      border-left: 4px solid #dc3545;
    }

    .test-result.warn {
      border-left: 4px solid #ffc107;
    }

    .icon {
      font-size: 1.5rem;
    }

    .browser-info {
      padding: 1rem;
      background: white;
      border-radius: 8px;
      margin-bottom: 2rem;
    }

    .browser-info table {
      width: 100%;
      border-collapse: collapse;
    }

    .browser-info td {
      padding: 0.5rem;
      border-bottom: 1px solid #e0e0e0;
    }

    .browser-info td:first-child {
      font-weight: 600;
      color: #666;
      width: 150px;
    }

    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 6px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    button:hover {
      background: #5568d3;
      transform: translateY(-2px);
    }

    .summary {
      margin-top: 2rem;
      padding: 1.5rem;
      border-radius: 8px;
      text-align: center;
      font-size: 1.2rem;
      font-weight: 600;
    }

    .summary.pass {
      background: #d4edda;
      color: #155724;
    }

    .summary.fail {
      background: #f8d7da;
      color: #721c24;
    }

    code {
      background: #f5f5f5;
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß™ DashDig Widget - Browser Compatibility Test</h1>
    <p class="subtitle">Testing widget compatibility in your browser</p>

    <!-- Browser Info -->
    <div class="browser-info">
      <table>
        <tr>
          <td>Browser:</td>
          <td id="browser-name"></td>
        </tr>
        <tr>
          <td>Version:</td>
          <td id="browser-version"></td>
        </tr>
        <tr>
          <td>User Agent:</td>
          <td id="user-agent"></td>
        </tr>
        <tr>
          <td>Platform:</td>
          <td id="platform"></td>
        </tr>
      </table>
    </div>

    <!-- Feature Detection -->
    <div class="test-section">
      <h2>Browser Features</h2>
      <div id="feature-tests"></div>
    </div>

    <!-- Widget Tests -->
    <div class="test-section">
      <h2>Widget Tests</h2>
      <div id="widget-tests"></div>
      <button onclick="runWidgetTests()" style="margin-top: 1rem;">Run Widget Tests</button>
    </div>

    <!-- Summary -->
    <div id="summary" class="summary" style="display: none;"></div>
  </div>

  <!-- Load Widget -->
  <script src="../dist/dashdig.min.js"></script>

  <script>
    // Browser Detection
    function detectBrowser() {
      const ua = navigator.userAgent;
      let browser = 'Unknown';
      let version = 'Unknown';

      if (ua.indexOf('Firefox') > -1) {
        browser = 'Firefox';
        version = ua.match(/Firefox\/(\d+)/)?.[1];
      } else if (ua.indexOf('Chrome') > -1) {
        browser = 'Chrome';
        version = ua.match(/Chrome\/(\d+)/)?.[1];
      } else if (ua.indexOf('Safari') > -1 && ua.indexOf('Chrome') === -1) {
        browser = 'Safari';
        version = ua.match(/Version\/(\d+)/)?.[1];
      } else if (ua.indexOf('Edg') > -1) {
        browser = 'Edge';
        version = ua.match(/Edg\/(\d+)/)?.[1];
      }

      document.getElementById('browser-name').textContent = browser;
      document.getElementById('browser-version').textContent = version || 'Unknown';
      document.getElementById('user-agent').textContent = ua;
      document.getElementById('platform').textContent = navigator.platform;

      return { browser, version: parseInt(version) || 0 };
    }

    // Feature Tests
    function runFeatureTests() {
      const features = [
        {
          name: 'ES2015+ Support',
          test: () => {
            try {
              eval('const x = (a) => a;');
              return true;
            } catch (e) {
              return false;
            }
          }
        },
        {
          name: 'Fetch API',
          test: () => typeof fetch !== 'undefined'
        },
        {
          name: 'Promise',
          test: () => typeof Promise !== 'undefined'
        },
        {
          name: 'LocalStorage',
          test: () => {
            try {
              localStorage.setItem('test', 'test');
              localStorage.removeItem('test');
              return true;
            } catch (e) {
              return false;
            }
          }
        },
        {
          name: 'Shadow DOM',
          test: () => 'attachShadow' in Element.prototype
        },
        {
          name: 'Intersection Observer',
          test: () => 'IntersectionObserver' in window
        },
        {
          name: 'Request Idle Callback',
          test: () => 'requestIdleCallback' in window
        },
        {
          name: 'Service Worker',
          test: () => 'serviceWorker' in navigator
        }
      ];

      const container = document.getElementById('feature-tests');
      features.forEach(feature => {
        const result = feature.test();
        container.innerHTML += `
          <div class="test-result ${result ? 'pass' : 'warn'}">
            <span class="icon">${result ? '‚úÖ' : '‚ö†Ô∏è'}</span>
            <span>${feature.name}</span>
          </div>
        `;
      });
    }

    // Widget Tests
    function runWidgetTests() {
      const container = document.getElementById('widget-tests');
      container.innerHTML = '';

      const tests = [];

      // Test 1: Widget loads
      tests.push({
        name: 'Widget script loaded',
        test: typeof DashdigWidget !== 'undefined' || typeof Dashdig !== 'undefined'
      });

      // Test 2: Can create instance
      let widget;
      try {
        const DashdigClass = typeof DashdigWidget !== 'undefined' ? DashdigWidget : Dashdig;
        widget = new DashdigClass({ apiKey: 'test-key', autoShow: false });
        tests.push({
          name: 'Widget instance created',
          test: true
        });
      } catch (e) {
        tests.push({
          name: 'Widget instance created',
          test: false,
          error: e.message
        });
      }

      // Test 3: Methods exist
      if (widget) {
        tests.push({
          name: 'show() method exists',
          test: typeof widget.show === 'function'
        });
        tests.push({
          name: 'hide() method exists',
          test: typeof widget.hide === 'function'
        });
        tests.push({
          name: 'track() method exists',
          test: typeof widget.track === 'function'
        });
        tests.push({
          name: 'destroy() method exists',
          test: typeof widget.destroy === 'function'
        });
      }

      // Test 4: No errors in console
      tests.push({
        name: 'No console errors',
        test: true  // Would need console monitoring
      });

      // Display results
      tests.forEach(test => {
        container.innerHTML += `
          <div class="test-result ${test.test ? 'pass' : 'fail'}">
            <span class="icon">${test.test ? '‚úÖ' : '‚ùå'}</span>
            <span>${test.name}${test.error ? ': ' + test.error : ''}</span>
          </div>
        `;
      });

      // Show summary
      const allPassed = tests.every(t => t.test);
      const summary = document.getElementById('summary');
      summary.style.display = 'block';
      summary.className = 'summary ' + (allPassed ? 'pass' : 'fail');
      summary.textContent = allPassed 
        ? '‚úÖ All tests passed! Widget is compatible with your browser.'
        : '‚ùå Some tests failed. Check the results above.';

      // Cleanup
      if (widget && widget.destroy) {
        widget.destroy();
      }
    }

    // Run tests on load
    detectBrowser();
    runFeatureTests();

    // Browser version check
    const browserInfo = detectBrowser();
    const minVersions = {
      Chrome: 90,
      Firefox: 88,
      Safari: 14,
      Edge: 90
    };

    if (minVersions[browserInfo.browser] && browserInfo.version < minVersions[browserInfo.browser]) {
      alert(`Warning: Your ${browserInfo.browser} version (${browserInfo.version}) is below the recommended minimum (${minVersions[browserInfo.browser]}). Some features may not work correctly.`);
    }
  </script>
</body>
</html>

