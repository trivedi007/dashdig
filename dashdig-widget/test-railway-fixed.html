<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Widget Test - Railway (Fixed)</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
    button { background: #4F46E5; color: white; border: none; padding: 12px 24px; 
             border-radius: 6px; cursor: pointer; font-size: 16px; }
    button:hover { background: #4338CA; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    input { width: 100%; padding: 10px; font-size: 16px; border: 1px solid #ccc; 
            border-radius: 4px; box-sizing: border-box; }
    #result { margin-top: 20px; padding: 15px; border-radius: 6px; }
    .success { background: #D1FAE5; color: #065F46; border: 1px solid #A7F3D0; }
    .error { background: #FEE2E2; color: #991B1B; border: 1px solid #FECACA; }
    .loading { background: #FEF3C7; color: #92400E; border: 1px solid #FDE68A; }
    a { color: #2563EB; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <h1>üöÄ DashDig Widget - Railway Test (Fixed)</h1>
  
  <div>
    <input id="urlInput" type="text" 
           value="https://example.com/test-123" 
           placeholder="Enter URL to shorten">
  </div>
  
  <div style="margin-top: 10px;">
    <button id="shortenBtn" onclick="testShorten()">Shorten URL</button>
  </div>
  
  <div id="result"></div>

  <script>
    async function testShorten() {
      const resultDiv = document.getElementById('result');
      const button = document.getElementById('shortenBtn');
      const url = document.getElementById('urlInput').value;
      
      try {
        button.disabled = true;
        resultDiv.className = 'loading';
        resultDiv.innerHTML = '<strong>‚è≥ Shortening...</strong>';
        
        // Call /demo-url endpoint (no auth needed)
        const response = await fetch('https://dashdig-production.up.railway.app/demo-url', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url, keywords: [] })
        });
        
        if (!response.ok) {
          throw new Error('HTTP ' + response.status + ': ' + response.statusText);
        }
        
        const data = await response.json();
        console.log('API Response:', data);
        
        // Parse the response correctly
        if (data.success && data.data) {
          const shortUrl = data.data.shortUrl;
          const slug = data.data.slug;
          
          resultDiv.className = 'success';
          resultDiv.innerHTML = 
            '<strong>‚úÖ Success!</strong><br><br>' +
            '<strong>Short URL:</strong> <a href="' + shortUrl + '" target="_blank">' + shortUrl + '</a><br>' +
            '<strong>Slug:</strong> <code>' + slug + '</code><br>' +
            '<strong>Original:</strong> ' + url + '<br><br>' +
            '<em>Click the short URL to test redirect!</em>';
        } else {
          throw new Error('Invalid response format');
        }
        
      } catch (error) {
        console.error('Error:', error);
        resultDiv.className = 'error';
        resultDiv.innerHTML = '<strong>‚ùå Error:</strong> ' + error.message;
      } finally {
        button.disabled = false;
      }
    }
  </script>
</body>
</html>
